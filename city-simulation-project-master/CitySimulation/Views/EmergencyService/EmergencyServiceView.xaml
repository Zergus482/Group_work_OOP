<UserControl x:Class="CitySimulation.Views.EmergencyService.EmergencyServiceView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             Height="Auto" Width="Auto">

    <UserControl.Resources>
        <x:Array x:Key="EmergencyTypes" Type="sys:String">
            <sys:String>Пожар</sys:String>
            <sys:String>ДТП</sys:String>
            <sys:String>Химическая авария</sys:String>
            <sys:String>Медицинская помощь</sys:String>
            <sys:String>Стихийное бедствие</sys:String>
        </x:Array>
    </UserControl.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">
        <Grid MinHeight="600" MinWidth="1000">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <TextBlock Grid.Row="0" Text="Пожарные службы (МЧС)" FontSize="20" FontWeight="Bold" Margin="10"/>

            <Grid Grid.Row="1" Margin="10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="10"/>
                    <!-- Разделитель -->
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Левая панель -->
                <ScrollViewer Grid.Column="0" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                    <StackPanel Margin="0,0,5,0">
                        <TextBlock Text="Пожарные части:" FontWeight="Bold" Margin="0,0,0,5"/>
                        <ListBox ItemsSource="{Binding EmergencyServiceVM.FireStations}" 
                                 SelectedItem="{Binding EmergencyServiceVM.SelectedStation}"
                                 Height="150" Margin="0,0,0,10">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel>
                                        <TextBlock Text="{Binding Name}" FontWeight="Bold"/>
                                        <TextBlock Text="{Binding ServedDistrict}"/>
                                        <TextBlock Text="{Binding MaxVehicles, StringFormat='Вместимость: {0}'}"/>
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>

                        <!-- Форма добавления пожарной части -->
                        <GroupBox Header="Добавить пожарную часть" Margin="0,0,0,10">
                            <StackPanel>
                                <TextBlock Text="Название:" Margin="0,0,0,2"/>
                                <TextBox Text="{Binding EmergencyServiceVM.NewStationName}" Height="25" Margin="0,0,0,5"/>

                                <TextBlock Text="Район:" Margin="0,0,0,2"/>
                                <TextBox Text="{Binding EmergencyServiceVM.NewStationDistrict}" Height="25" Margin="0,0,0,5"/>

                                <TextBlock Text="Вместимость:" Margin="0,0,0,2"/>
                                <TextBox Text="{Binding EmergencyServiceVM.NewStationCapacity}" Height="25" Margin="0,0,0,5"/>

                                <Button Content="Добавить часть" 
                                        Command="{Binding EmergencyServiceVM.AddFireStationCommand}"
                                        Width="120" Height="30"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- Форма добавления техники -->
                        <GroupBox Header="Добавить технику" Margin="0,0,0,10">
                            <StackPanel>
                                <TextBlock Text="Название техники:" Margin="0,0,0,2"/>
                                <TextBox Text="{Binding EmergencyServiceVM.NewVehicleName}" Height="25" Margin="0,0,0,5"/>

                                <TextBlock Text="Объем воды (л):" Margin="0,0,0,2"/>
                                <TextBox Text="{Binding EmergencyServiceVM.NewVehicleWater}" Height="25" Margin="0,0,0,5"/>

                                <TextBlock Text="Мощность насоса (л/с):" Margin="0,0,0,2"/>
                                <TextBox Text="{Binding EmergencyServiceVM.NewVehiclePumpPower}" Height="25" Margin="0,0,0,5"/>

                                <Button Content="Добавить технику" 
                                        Command="{Binding EmergencyServiceVM.AddVehicleCommand}"
                                        Width="120" Height="30"/>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>
                </ScrollViewer>

                <!-- Правая панель -->
                <ScrollViewer Grid.Column="2" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                    <StackPanel Margin="5,0,0,0">
                        <!-- Управление вызовами -->
                        <GroupBox Header="Экстренные вызовы" Margin="0,0,0,10">
                            <StackPanel>
                                <TextBlock Text="Тип вызова:" Margin="0,0,0,2"/>
                                <ComboBox ItemsSource="{StaticResource EmergencyTypes}"
                                          SelectedValue="{Binding EmergencyServiceVM.NewEmergencyType}"
                                          Height="25" Margin="0,0,0,5"/>

                                <TextBlock Text="Уровень угрозы (1-5):" Margin="0,0,0,2"/>
                                <TextBox Text="{Binding EmergencyServiceVM.NewEmergencyThreat}" Height="25" Margin="0,0,0,5"/>

                                <Button Content="Создать вызов" 
                                        Command="{Binding EmergencyServiceVM.CreateEmergencyCommand}"
                                        Width="120" Height="30" Margin="0,0,0,10"/>

                                <TextBlock Text="Активные вызовы:" FontWeight="Bold" Margin="0,0,0,5"/>
                                <ListBox ItemsSource="{Binding EmergencyServiceVM.EmergencyCalls}" 
                                         SelectedItem="{Binding EmergencyServiceVM.SelectedCall}"
                                         Height="100" Margin="0,0,0,10">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel>
                                                <TextBlock Text="{Binding EmergencyType}" FontWeight="Bold"/>
                                                <TextBlock Text="{Binding ThreatLevel, StringFormat='Уровень угрозы: {0}'}"/>
                                                <TextBlock Text="{Binding CallTime, StringFormat='Время: {0:HH:mm}'}"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>

                                <Button Content="Отправить подразделение" 
                                        Command="{Binding EmergencyServiceVM.DispatchUnitsCommand}"
                                        Width="180" Height="35" FontWeight="Bold"
                                        Background="LightCoral"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- Техника -->
                        <GroupBox Header="Пожарная техника">
                            <StackPanel>
                                <TextBlock Text="Доступная техника:" FontWeight="Bold" Margin="0,0,0,5"/>
                                <ListBox ItemsSource="{Binding EmergencyServiceVM.Vehicles}" Height="120">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel>
                                                <TextBlock Text="{Binding Name}" FontWeight="Bold"/>
                                                <TextBlock Text="{Binding CurrentWater, StringFormat='Вода: {0}л'}" FontSize="10"/>
                                                <TextBlock Text="{Binding CurrentState, StringFormat='Статус: {0}'}" FontSize="9"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>
                </ScrollViewer>
            </Grid>

            <StatusBar Grid.Row="2" Background="LightGray">
                <TextBlock Text="{Binding EmergencyServiceVM.StatusMessage}" FontWeight="Bold"/>
            </StatusBar>
        </Grid>
    </ScrollViewer>
</UserControl>